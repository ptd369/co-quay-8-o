<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTFâ€‘8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>SÃºng Lá»¥c Revolver â€“ Chuáº©n CÆ¡ Cháº¿</title>
  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:black; font-family:sans-serif; }
    body.landscape { background:url('assets/background.jpg') center/cover no-repeat; }
    .start-screen {position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:black;color:white;font-size:24px;z-index:999;}
    .container {display:none;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:100vw;text-align:center;}
    .gun-image {width:60vw;max-width:400px;pointer-events:none;}
    .controls {margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
    .controls button {padding:10px 18px;font-size:0.9rem;font-weight:bold;border:none;border-radius:6px;background:#ff5252;color:#fff;cursor:pointer;}
    .cylinder-view {display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:220px;height:220px;border-radius:50%;background:rgba(0,0,0,0.6);z-index:2;}
    .cylinder-view.spinning {animation:spinEffect 3s ease-out;}
    @keyframes spinEffect {0%{transform:translate(-50%,-50%) rotate(0);}100%{transform:translate(-50%,-50%) rotate(1440deg);}}
    .chamber {position:absolute;width:40px;height:40px;background:#444;border:2px solid #aaa;border-radius:50%;cursor:pointer;}
    .chamber.loaded {background:red;}
    .smoke {position:absolute;width:80px;height:80px;background:url('assets/smoke.png') center/contain no-repeat;opacity:0;animation:puff 0.5s ease-out forwards;left:50%;top:50%;transform:translate(-50%,-50%);z-index:3;}
    .bullet {position:absolute;width:20px;height:10px;background:gold;border-radius:5px;animation:fly 0.5s ease-out forwards;left:50%;top:50%;transform:translate(-50%,-50%);z-index:3;}
    @keyframes puff {0%{opacity:1;transform:translate(-50%,-50%) scale(0.5);}100%{opacity:0;transform:translate(-50%,-50%) scale(1.5);}}
    @keyframes fly {0%{left:50%;top:50%;}100%{left:100vw;top:40%;}}
    @media screen and (orientation:portrait) {
      body.landscape::before {
        content:'Vui lÃ²ng xoay ngang mÃ n hÃ¬nh Ä‘á»ƒ chÆ¡i';
        position:fixed;top:50%;left:50%;
        transform:translate(-50%,-50%);
        background:rgba(0,0,0,0.85);color:#fff;
        padding:20px;font-size:18px;border-radius:10px;z-index:1000;
      }
    }
  </style>
</head>
<body>
  <div class="start-screen" id="startScreen">Cháº¡m Ä‘á»ƒ báº¯t Ä‘áº§u</div>
  <div class="container" id="gameContainer">
    <img id="gun" class="gun-image" src="assets/gun.png" alt="SÃºng">
    <div class="controls">
      <button onclick="fire()">ðŸ”« BÃ³p cÃ²</button>
      <button onclick="spinCylinder()">ðŸŒ€ Xoay á»•</button>
      <button onclick="toggleCylinderView()">ðŸ”„ Náº¡p Ä‘áº¡n</button>
    </div>
  </div>
  <div class="cylinder-view" id="cylinderView"></div>

  <!-- Ã‚m thanh -->
  <audio id="sfx-load" src="assets/reload.mp3"></audio>
  <audio id="sfx-spin" src="assets/spin.mp3"></audio>
  <audio id="sfx-fire" src="assets/gunshot.mp3"></audio>
  <audio id="sfx-click" src="assets/click.mp3"></audio>

  <script>
    let chambers = new Array(8).fill(false);
    let lastShake = 0;

    function playSound(id) {
      const audio = document.getElementById(id);
      if (audio) { audio.currentTime = 0; audio.play(); }
    }

    function rotateArray(arr, count) {
      return arr.slice(count).concat(arr.slice(0, count));
    }

    function updateCylinder() {
      const container = document.getElementById('cylinderView');
      container.innerHTML = '';
      const R = 80, cx=110, cy=110;
      for (let i = 0; i < 8; i++) {
        const angle = (i * 360 / 8) * Math.PI / 180;
        const x = cx + R * Math.cos(angle);
        const y = cy + R * Math.sin(angle);
        const div = document.createElement('div');
        div.className = 'chamber' + (chambers[i] ? ' loaded' : '');
        div.style.left = `${x - 20}px`;
        div.style.top = `${y - 20}px`;
        div.onclick = () => { chambers[i] = !chambers[i]; if (chambers[i]) playSound('sfx-load'); updateCylinder(); };
        container.appendChild(div);
      }
    }

    function spinCylinder() {
      const shift = Math.floor(Math.random() * 8);
      chambers = rotateArray(chambers, shift);
      const cylinder = document.getElementById('cylinderView');
      cylinder.classList.add('spinning');
      playSound('sfx-spin');
      document.getElementById('sfx-spin').onended = () => cylinder.classList.remove('spinning');
      updateCylinder();
    }

    function fire() {
      if (document.getElementById('cylinderView').style.display === 'block') return;
      if (chambers[0]) {
        chambers[0] = false;
        playSound('sfx-fire');
        showSmoke();
        showBullet();
      } else {
        playSound('sfx-click');
      }
      chambers = rotateArray(chambers, 1);
      updateCylinder();
    }

    function toggleCylinderView() {
      const view = document.getElementById('cylinderView');
      view.style.display = view.style.display === 'block' ? 'none' : 'block';
      updateCylinder();
    }

    function showSmoke() {
      const smoke = document.createElement('div');
      smoke.className = 'smoke';
      document.body.appendChild(smoke);
      setTimeout(() => smoke.remove(), 600);
    }

    function showBullet() {
      const bullet = document.createElement('div');
      bullet.className = 'bullet';
      document.body.appendChild(bullet);
      setTimeout(() => bullet.remove(), 600);
    }

    window.addEventListener("devicemotion", function (e) {
      const acc = e.accelerationIncludingGravity;
      const strength = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
      const now = Date.now();
      if (strength > 25 && now - lastShake > 800) {
        fire();
        lastShake = now;
      }
    });

    window.onload = () => {
      document.getElementById('startScreen').addEventListener('click', () => {
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameContainer').style.display = 'flex';
        document.body.classList.add('landscape');
      });
    };
  </script>
</body>
</html>
